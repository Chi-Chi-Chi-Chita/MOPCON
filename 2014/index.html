<html>
<head><title>[MOPCON 2014]</title>
<style>
html,body{padding:0;margin:0;background-color:#000;}
#wrapper{position:absolute;top:50%;left:50%; width:800px; height:450px;margin-left:-400px;margin-top:-225px;}
#q{position:relative;top:0;left:0;z-index:10;}
#placeHolder{position:absolute;z-index:1;}
#main{position:relative;margin:auto;}
</style>
</head>
<div id="wrapper">
<img id="placeHolder" src="img/2014_preview_bg_lossy.jpg"></img>
<canvas id='q'></canvas>
</div>

<script>
var text_pool = [
//  "其中還隱約現出樓台。這下回還清罷。小琴。嘴裡喊一聲。",
//  "沒有在！風和日暖。眼圈顯得微黃？都擺在自己的面前了。",
//  "天真可愛小女孩，小女孩，小女孩...",
//  "賠，仰頭看著對面壁上的彤弓，歎一口氣，雪梨的千萬住民在瞬間消散成為灰燼這多悲傷呀。",
//  "行動應用近年成為媒體追逐之寵兒，從電子商務、數位內容、商業服務、消費應用無不積極行動相關領域發展。MOPCON 專注於行動軟體開發/ 應用技術之專業研討會。",
//  "Mobile Open Platform Conference，行動科技應用開發者年會，或稱 MOPCON，繼去年舉辦後，移動式平台業界發生了很多變化",
//  "軟硬體整合一直是近期熱門話題，讓Ernest Chiang 來聊聊PAFERS Tech 創業過程中，在全球健身器材產業從軟硬整合技術到商業、法律層面的全面向探討。",
//  "這邊感覺可以埋很多奇怪的梗進來"
"\u84ec\u840a\u6b64\u53bb\u7121\u591a\u8def \u6843\u82b1\u76e1\u65e5\u96a8\u6d41\u6c34",
"\u7530\u5712\u5be5\u843d\u5e72\u6208\u5f8c \u6625\u98a8\u8209\u570b\u88c1\u5bae\u9326",
"\u6b64\u5730\u7a7a\u9918\u9ec3\u9db4\u6a13 \u967d\u548c\u4e0d\u6563\u7aae\u9014\u6068",
"\u4e00\u9ad4\u541b\u81e3\u796d\u7940\u540c \u821f\u4eba\u6307\u9ede\u5230\u4eca\u7591",
"\u65b7\u7121\u6d88\u606f\u77f3\u69b4\u7d05 \u904b\u79fb\u6f22\u795a\u7d42\u96e3\u5fa9",
"\u820d\u5357\u820d\u5317\u7686\u6625\u6c34 \u5343\u8f09\u7435\u7436\u4f5c\u80e1\u8a9e",
"\u7d17\u7a97\u65e5\u843d\u6f38\u9ec3\u660f \u6668\u6416\u7389\u73ee\u8da8\u91d1\u6bbf",
"\u5ae6\u5a25\u61c9\u6094\u5077\u9748\u85e5 \u671b\u4ed9\u6a13\u4e0a\u671b\u541b\u738b",
"\u5bd2\u98df\u6771\u98a8\u5fa1\u67f3\u659c \u4f2f\u4ef2\u4e4b\u9593\u898b\u4f0a\u5442",
"\u53ef\u6190\u5f8c\u4e3b\u9084\u7960\u5edf \u5949\u5e1a\u5e73\u660e\u91d1\u6bbf\u958b",
"\u4e00\u5bf8\u60f3\u601d\u4e00\u5bf8\u7070 \u8d0f\u5f97\u9752\u6a13\u8584\u5016\u540d",
"\u6545\u4eba\u897f\u8fad\u9ec3\u9db4\u6a13 \u5373\u5f9e\u5df4\u5cfd\u7a7f\u5deb\u5cfd",
"\u5d69\u96f2\u79e6\u6a39\u4e45\u96e2\u5c45 \u4f55\u7576\u5171\u526a\u897f\u7a97\u71ed",
"\u53bb\u6642\u51a0\u528d\u662f\u4e01\u5e74 \u91ce\u852c\u5145\u81b3\u7518\u9577\u85ff",
"\u6674\u5ddd\u6b77\u6b77\u6f22\u967d\u6a39 \u501f\u554f\u8def\u508d\u540d\u5229\u5ba2",
"\u4f46\u4f7f\u9f8d\u57ce\u98db\u5c07\u5728 \u95a8\u4e2d\u5c11\u5a66\u4e0d\u77e5\u6101",
"\u672a\u82e5\u8ca7\u800c\u6a02\uff0c\u8cdc\u4e5f\uff0c\u5b50\u66f0\uff0c\u662f\u53ef\u5fcd\u4e5f\uff01",
"\u541b\u4f7f\u81e3\u3002\u4e0d\u4ee5\u79ae\u7bc0\u4e4b\u3002\u529b\u4e0d\u8db3\u8005\uff0c\u541b\u800c\u77e5\u79ae\u3002\u5c11\u8005\u61f7\u4e4b\uff1f",
"\u53ef\u4ee5\u70ba\u5e2b\u77e3\uff01\u543e\u4ea6\u6b32\u7121\u52a0\u8af8\u4eba\u3002\u5b50\u66f0\uff01\u5206\u4f5c\u6e9d\u4e2d\u7620\uff0c\u865b\u800c\u70ba\u76c8\u3002\u6bcb\uff0c\u7109\u5f97\u525b\uff0c\u4e0d\u6c72\u6c72\u65bc\u5bcc\u8cb4\u3002",
"\u96d6\u57f7\u97ad\u4e4b\u58eb\uff0c\u653e\u65bc\u5229\u800c\u884c\u3002\u8209\u76f4\u932f\u8af8\u6789\uff0c\u5b50\u66f0\u3002\u800c\u8b70\u8005\u8b02\u70ba\u975e\u8a08\uff0c\u6211\u6b32\u4ec1\uff0c\u6a02\u4ea6\u5728\u5176\u4e2d\u77e3\uff0c\u4e0d\u4ee5\u5176\u9053\u5f97\u4e4b\u3002\u54c0\u516c\u554f\u793e\u65bc\u5bb0\u6211\uff0c\u5b5d\u4e4e\u60df\u5b5d\uff0c\u4e0d\u4fdd\u5176\u5f80\u4e5f\uff0c\u7121\u4ee5\u5c1a\u4e4b\u3002",
"\u8ce2\u80fd\u70ba\u4e4b\u7528\u3002\u5728\u9f4a\u592a\u53f2\u7c21\uff1f\u5fe0\uff0c\u5fe0\u4ee5\u52f8\uff0c\u4e0d\u6548\u5247\u6cbb\u81e3\u4e4b\u7f6a\u3002\u4ec1\u8005\u6a02\u5c71\u3002\u4e0d\u6065\u4e0b\u554f\u3002\u4e0d\u80fd\u4ee5\u79ae\u8b93\u70ba\u570b\uff0c\u60e1\u4e0d\u4ec1\u8005\u3002\u5b50\u66f0\uff0c\u7109\u7528\u4f5e\uff0c\u543e\u4f55\u4ee5\u89c0\u4e4b\u54c9\uff0c\u5b50\u66f0\uff01\u6bcf\u4e8b\u554f\uff0c\u5b50\u66f0\u3002",
"\u5b50\u66f0\u3002\u4e0d\u80fd\uff0c\u52d9\u6c11\u4e4b\u7fa9\u3002\u543e\u805e\u4e4b\u4e5f\uff0c\u96cd\u4e5f\u3002\u4e8b\u4e0d\u53ef\u606f\uff0c\u5df2\u77e3\u4e4e\uff0c\u8996\u5176\u6240\u4ee5\u3002\u5b50\u66f0\uff0c\u66fe\u5b50\u6709\u75be\uff0c\u4e0d\u60b1\u4e0d\u767c\u3002\u66f0\u3002\u5b50\u8b02\u516c\u51b6\u9577\u3002",
"\u81f3\u65bc\u9b6f\u3002",
"\u4e0d\u4ea6\u91cd\u4e4e\uff0c\u800c\u4e0d\u53ca\u4eca\u5716\u4e4b\uff0c\u4e0d\u4ee5\u5176\u9053\u5f97\u4e4b\uff01\u5b50\u66f0\uff0c\u5b50\u590f\u554f\u5b5d\uff1f\u66f0\u3002",
];


var color_pool = ["#1d2844","#535355", "#1c7f9f", "#25395a", "#5f5f5f"];

var def_font_size = 8;
var min_font_size = 3;
var max_font_size = 19;
var padding = 4;



function randomText(){
    return text_pool[Math.floor(Math.random()*text_pool.length)];
}

function randomColor(){
    return color_pool[Math.floor(Math.random()*color_pool.length)];
}

function randomFontSize(){
    var min = min_font_size;
    var max = max_font_size;
    return min + Math.floor(Math.random()*(max-min));
}


bgImg = new Image();
bgImg.src = "img/2014_preview_bg.jpg";


var letter_layer = document.createElement('canvas');
var letter_ctx = letter_layer.getContext('2d');
var bg_layer = q;
var bg_ctx = bg_layer.getContext('2d');

function initLetters(){
    var width = letter_layer.width = q.parentNode.clientWidth;
    var height = letter_layer.height =q.parentNode.clientHeight;
    
    var cc = Math.floor(width/def_font_size);
    window.letters = Array(cc);
    
    for (var i = 0; i < cc; i++) {
        letters[i] = {
            "color": randomColor(),
            "x": i*(def_font_size+padding)+2,
            "y": 1,
            "idx": 0,
            "text": randomText(),
            "size": def_font_size,
        }
    }

    letter_ctx.fillStyle='rgba(0,0,0)';
    letter_ctx.fillRect(0,0,q.width,q.height);

    var gl = letter_ctx.createLinearGradient(letter_layer.width/3, 0, letter_layer.width/2, 0);
    gl.addColorStop(0,"rgba(0,0,0,0)");
    gl.addColorStop(1,"rgba(0,0,0,1)");

    var gr = letter_ctx.createLinearGradient(letter_layer.width/2, 0, letter_layer.width/3*2, 0);
    gr.addColorStop(0,"rgba(0,0,0,1)");
    gr.addColorStop(1,"rgba(0,0,0,0)");

    letter_ctx.drawCenterShadow = function(){
        this.fillStyle=gl;
        this.fillRect(letter_layer.width/3, 0, letter_layer.width/6, letter_layer.height);
        this.fillStyle=gr;
        this.fillRect(letter_layer.width/2, 0, letter_layer.width/6, letter_layer.height);
    };
}


function initBG(){
    var width = bg_layer.width = q.parentNode.clientWidth;
    var height = bg_layer.height =q.parentNode.clientHeight;
}

function initAll(){
    initLetters();
    initBG();
}


style = 'rgba(0,0,0,0.05)';
var draw = function () {
  letter_ctx.fillStyle=style;
  letter_ctx.fillRect(0,0,letter_layer.width,letter_layer.height);
  letters.map(function(letter, index){
    
    if (letter.text.length+3<letter.idx) {
      letter.idx = 0;
      letter.text = randomText();
      letter.color = randomColor();
    } 
    
    var c = (letter.text.length<=letter.idx) ? "" : letter.text[letter.idx];
    letter_ctx.fillStyle = letter.color;
    letter_ctx.font = "normal "+letter.size+"px sans-serif";
    letter_ctx.fillText(c, letter.x, letter.y);
    letter.idx++;
    
    if (letter.y > letter_layer.height + Math.random() * 1e4) {
      letter.size = randomFontSize();
      letter.y = 0;
    } else {
      letter.y += (letter.size+padding);
    }
  });
  letter_ctx.drawCenterShadow();


  bg_ctx.globalAlpha = 1;
  bg_ctx.globalCompositeOperation = "copy";
  bg_ctx.fillStyle='rgba(0,0,0)';
  bg_ctx.drawImage(bgImg,0,0);
  bg_ctx.globalAlpha = 0.5;
  bg_ctx.globalCompositeOperation = "lighter";
  bg_ctx.drawImage(letter_layer,0,0);
};

bgImg.onload = function(){
    initAll();
    setInterval(draw, 1000/20);
}

</script>
</html>
